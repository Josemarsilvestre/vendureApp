{"version":3,"names":["defineAnimation","withRepeat","_nextAnimation","numberOfReps","arguments","length","undefined","reverse","callback","nextAnimation","repeat","animation","now","finished","onFrame","current","reps","startValue","toValue","onStart","previousAnimation","repCallback","value","isHigherOrder"],"sources":["repeat.ts"],"sourcesContent":["import { defineAnimation } from './util';\nimport {\n  Animation,\n  AnimationCallback,\n  AnimatableValue,\n  Timestamp,\n} from '../commonTypes';\nimport { NextAnimation, RepeatAnimation } from './commonTypes';\n\nexport interface InnerRepeatAnimation\n  extends Omit<RepeatAnimation, 'toValue' | 'startValue'> {\n  toValue: number;\n  startValue: number;\n}\n\nexport function withRepeat(\n  _nextAnimation: NextAnimation<RepeatAnimation>,\n  numberOfReps = 2,\n  reverse = false,\n  callback?: AnimationCallback\n): Animation<RepeatAnimation> {\n  'worklet';\n\n  return defineAnimation<RepeatAnimation>(_nextAnimation, () => {\n    'worklet';\n\n    const nextAnimation: RepeatAnimation =\n      typeof _nextAnimation === 'function' ? _nextAnimation() : _nextAnimation;\n\n    function repeat(animation: InnerRepeatAnimation, now: Timestamp): boolean {\n      const finished = nextAnimation.onFrame(nextAnimation, now);\n      animation.current = nextAnimation.current;\n      if (finished) {\n        animation.reps += 1;\n        // call inner animation's callback on every repetition\n        // as the second argument the animation's current value is passed\n        if (nextAnimation.callback) {\n          nextAnimation.callback(true /* finished */, animation.current);\n        }\n        if (numberOfReps > 0 && animation.reps >= numberOfReps) {\n          return true;\n        }\n\n        const startValue = reverse\n          ? (nextAnimation.current as number)\n          : animation.startValue;\n        if (reverse) {\n          nextAnimation.toValue = animation.startValue;\n          animation.startValue = startValue;\n        }\n        nextAnimation.onStart(\n          nextAnimation,\n          startValue,\n          now,\n          nextAnimation.previousAnimation as RepeatAnimation\n        );\n        return false;\n      }\n      return false;\n    }\n\n    const repCallback = (finished: boolean): void => {\n      if (callback) {\n        callback(finished);\n      }\n      // when cancelled call inner animation's callback\n      if (!finished && nextAnimation.callback) {\n        nextAnimation.callback(false /* finished */);\n      }\n    };\n\n    function onStart(\n      animation: RepeatAnimation,\n      value: AnimatableValue,\n      now: Timestamp,\n      previousAnimation: RepeatAnimation\n    ): void {\n      animation.startValue = value;\n      animation.reps = 0;\n      nextAnimation.onStart(nextAnimation, value, now, previousAnimation);\n    }\n\n    return {\n      isHigherOrder: true,\n      onFrame: repeat,\n      onStart,\n      reps: 0,\n      current: nextAnimation.current,\n      callback: repCallback,\n      startValue: 0,\n    } as RepeatAnimation;\n  });\n}\n"],"mappings":"AAAA,SAASA,eAAe,QAAQ,QAAQ;AAexC,OAAO,SAASC,UAAUA,CACxBC,cAA8C,EAIlB;EAC5B,SAAS;;EAAC,IAJVC,YAAY,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC;EAAA,IAChBG,OAAO,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,KAAK;EAAA,IACfI,QAA4B,GAAAJ,SAAA,CAAAC,MAAA,OAAAD,SAAA,MAAAE,SAAA;EAI5B,OAAON,eAAe,CAAkBE,cAAc,EAAE,MAAM;IAC5D,SAAS;;IAET,MAAMO,aAA8B,GAClC,OAAOP,cAAc,KAAK,UAAU,GAAGA,cAAc,EAAE,GAAGA,cAAc;IAE1E,SAASQ,MAAMA,CAACC,SAA+B,EAAEC,GAAc,EAAW;MACxE,MAAMC,QAAQ,GAAGJ,aAAa,CAACK,OAAO,CAACL,aAAa,EAAEG,GAAG,CAAC;MAC1DD,SAAS,CAACI,OAAO,GAAGN,aAAa,CAACM,OAAO;MACzC,IAAIF,QAAQ,EAAE;QACZF,SAAS,CAACK,IAAI,IAAI,CAAC;QACnB;QACA;QACA,IAAIP,aAAa,CAACD,QAAQ,EAAE;UAC1BC,aAAa,CAACD,QAAQ,CAAC,IAAI,CAAC,gBAAgBG,SAAS,CAACI,OAAO,CAAC;QAChE;QACA,IAAIZ,YAAY,GAAG,CAAC,IAAIQ,SAAS,CAACK,IAAI,IAAIb,YAAY,EAAE;UACtD,OAAO,IAAI;QACb;QAEA,MAAMc,UAAU,GAAGV,OAAO,GACrBE,aAAa,CAACM,OAAO,GACtBJ,SAAS,CAACM,UAAU;QACxB,IAAIV,OAAO,EAAE;UACXE,aAAa,CAACS,OAAO,GAAGP,SAAS,CAACM,UAAU;UAC5CN,SAAS,CAACM,UAAU,GAAGA,UAAU;QACnC;QACAR,aAAa,CAACU,OAAO,CACnBV,aAAa,EACbQ,UAAU,EACVL,GAAG,EACHH,aAAa,CAACW,iBAAiB,CAChC;QACD,OAAO,KAAK;MACd;MACA,OAAO,KAAK;IACd;IAEA,MAAMC,WAAW,GAAIR,QAAiB,IAAW;MAC/C,IAAIL,QAAQ,EAAE;QACZA,QAAQ,CAACK,QAAQ,CAAC;MACpB;MACA;MACA,IAAI,CAACA,QAAQ,IAAIJ,aAAa,CAACD,QAAQ,EAAE;QACvCC,aAAa,CAACD,QAAQ,CAAC,KAAK,CAAC,eAAe;MAC9C;IACF,CAAC;;IAED,SAASW,OAAOA,CACdR,SAA0B,EAC1BW,KAAsB,EACtBV,GAAc,EACdQ,iBAAkC,EAC5B;MACNT,SAAS,CAACM,UAAU,GAAGK,KAAK;MAC5BX,SAAS,CAACK,IAAI,GAAG,CAAC;MAClBP,aAAa,CAACU,OAAO,CAACV,aAAa,EAAEa,KAAK,EAAEV,GAAG,EAAEQ,iBAAiB,CAAC;IACrE;IAEA,OAAO;MACLG,aAAa,EAAE,IAAI;MACnBT,OAAO,EAAEJ,MAAM;MACfS,OAAO;MACPH,IAAI,EAAE,CAAC;MACPD,OAAO,EAAEN,aAAa,CAACM,OAAO;MAC9BP,QAAQ,EAAEa,WAAW;MACrBJ,UAAU,EAAE;IACd,CAAC;EACH,CAAC,CAAC;AACJ"}