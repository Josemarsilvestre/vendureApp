{"version":3,"names":["shouldBeUseWeb","MutableValue","Mapper","constructor","module","mapper","inputs","arguments","length","undefined","outputs","_defineProperty","id","MAPPER_ID","extractMutablesFromArray","markDirty","dirty","maybeRequestRender","forEach","input","addListener","execute","array","res","extractMutables","value","push","Array","isArray","v","isWebDomElement","Object","keys","key","isWebNode","o","Node","nodeType","nodeName","isWebElement","HTMLElement"],"sources":["Mapper.ts"],"sourcesContent":["import { NestedObjectValues } from '../commonTypes';\nimport { shouldBeUseWeb } from '../PlatformChecker';\nimport { JSReanimated } from './commonTypes';\nimport MutableValue from './MutableValue';\n\nexport default class Mapper<T> {\n  static MAPPER_ID = 1;\n  id: number;\n  inputs: MutableValue<T>[];\n  outputs: MutableValue<T>[];\n  mapper: () => void;\n\n  dirty = true;\n\n  constructor(\n    module: JSReanimated,\n    mapper: () => void,\n    inputs: NestedObjectValues<MutableValue<T>>[] = [],\n    outputs: NestedObjectValues<MutableValue<T>>[] = []\n  ) {\n    this.id = Mapper.MAPPER_ID++;\n    this.inputs = this.extractMutablesFromArray(inputs);\n    this.outputs = this.extractMutablesFromArray(outputs);\n    this.mapper = mapper;\n\n    const markDirty = () => {\n      this.dirty = true;\n      module.maybeRequestRender();\n    };\n\n    this.inputs.forEach((input) => {\n      input.addListener(markDirty);\n    });\n  }\n\n  execute(): void {\n    this.dirty = false;\n    this.mapper();\n  }\n\n  extractMutablesFromArray<T>(\n    array: NestedObjectValues<MutableValue<T>>\n  ): MutableValue<T>[] {\n    const res: MutableValue<T>[] = [];\n\n    function extractMutables(value: NestedObjectValues<MutableValue<T>>) {\n      if (value == null) {\n        // return;\n      } else if (value instanceof MutableValue) {\n        res.push(value);\n      } else if (Array.isArray(value)) {\n        value.forEach((v) => extractMutables(v));\n      } else if (isWebDomElement(value)) {\n        // do nothing on dom elements\n        // without this check, we get a \"Maximum call size exceeded error\"\n      } else if (typeof value === 'object') {\n        Object.keys(value).forEach((key) => {\n          extractMutables(value[key]);\n        });\n      }\n    }\n\n    extractMutables(array);\n    return res;\n  }\n}\n\nfunction isWebDomElement(value: any) {\n  if (!shouldBeUseWeb()) {\n    return false;\n  }\n\n  // https://stackoverflow.com/a/384380/7869175\n  function isWebNode(o: any) {\n    return typeof Node === 'object'\n      ? o instanceof Node\n      : o &&\n          typeof o === 'object' &&\n          typeof o.nodeType === 'number' &&\n          typeof o.nodeName === 'string';\n  }\n\n  function isWebElement(o: any) {\n    return typeof HTMLElement === 'object'\n      ? o instanceof HTMLElement // DOM2\n      : o &&\n          typeof o === 'object' &&\n          o !== null &&\n          o.nodeType === 1 &&\n          typeof o.nodeName === 'string';\n  }\n\n  return isWebNode(value) || isWebElement(value);\n}\n"],"mappings":"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"}