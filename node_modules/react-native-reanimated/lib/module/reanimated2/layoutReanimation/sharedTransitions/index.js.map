{"version":3,"names":["withTiming","supportedProps","SharedTransition","constructor","_defineProperty","createInstance","custom","animationFactory","build","animationDuration","defaultDuration","values","animations","initialValues","key","includes","Error","propName","matrix","targetTransformMatrix","transformMatrix","duration","keyToTargetValue","charAt","toUpperCase","slice","currentTransformMatrix","keyToCurrentValue","DefaultSharedTransition"],"sources":["index.ts"],"sourcesContent":["import { withTiming } from '../../animation';\nimport {\n  ILayoutAnimationBuilder,\n  LayoutAnimationFunction,\n  LayoutAnimationsValues,\n} from '../animationBuilder/commonTypes';\nimport { StyleProps } from '../../commonTypes';\n\nconst supportedProps = ['width', 'height', 'originX', 'originY', 'transform'];\n\ntype AnimationFactoryType = (values: LayoutAnimationsValues) => StyleProps;\n\nexport class SharedTransition implements ILayoutAnimationBuilder {\n  animationFactory: AnimationFactoryType | null = null;\n  defaultDuration = 500;\n\n  static createInstance(): SharedTransition {\n    return new SharedTransition();\n  }\n\n  static custom(animationFactory: AnimationFactoryType): SharedTransition {\n    return this.createInstance().custom(animationFactory);\n  }\n\n  custom(animationFactory: AnimationFactoryType): SharedTransition {\n    this.animationFactory = animationFactory;\n    return this;\n  }\n\n  static build(): LayoutAnimationFunction {\n    return this.createInstance().build();\n  }\n\n  build(): LayoutAnimationFunction {\n    const animationFactory = this.animationFactory;\n    const animationDuration = this.defaultDuration;\n    return (values: LayoutAnimationsValues) => {\n      'worklet';\n      let animations: {\n        [key: string]: any;\n      } = {};\n      const initialValues: {\n        [key: string]: any;\n      } = {};\n\n      if (animationFactory) {\n        animations = animationFactory(values);\n        for (const key in animations) {\n          if (!supportedProps.includes(key)) {\n            throw Error(`The prop '${key}' is not supported yet.`);\n          }\n        }\n      } else {\n        for (const propName of supportedProps) {\n          if (propName === 'transform') {\n            const matrix = values.targetTransformMatrix;\n            animations.transformMatrix = withTiming(matrix, {\n              // native screen transition takes around 500ms\n              duration: animationDuration,\n            });\n          } else {\n            const keyToTargetValue =\n              'target' + propName.charAt(0).toUpperCase() + propName.slice(1);\n            animations[propName] = withTiming(values[keyToTargetValue], {\n              // native screen transition takes around 500ms\n              duration: animationDuration,\n            });\n          }\n        }\n      }\n\n      for (const propName in animations) {\n        if (propName === 'transform') {\n          initialValues.transformMatrix = values.currentTransformMatrix;\n        } else {\n          const keyToCurrentValue =\n            'current' + propName.charAt(0).toUpperCase() + propName.slice(1);\n          initialValues[propName] = values[keyToCurrentValue];\n        }\n      }\n\n      return { initialValues, animations };\n    };\n  }\n}\n\nexport const DefaultSharedTransition = SharedTransition;\n"],"mappings":";;;AAAA,SAASA,UAAU,QAAQ,iBAAiB;AAQ5C,MAAMC,cAAc,GAAG,CAAC,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,SAAS,EAAE,WAAW,CAAC;AAI7E,OAAO,MAAMC,gBAAgB,CAAoC;EAAAC,YAAA;IAAAC,eAAA,2BACf,IAAI;IAAAA,eAAA,0BAClC,GAAG;EAAA;EAErB,OAAOC,cAAcA,CAAA,EAAqB;IACxC,OAAO,IAAIH,gBAAgB,EAAE;EAC/B;EAEA,OAAOI,MAAMA,CAACC,gBAAsC,EAAoB;IACtE,OAAO,IAAI,CAACF,cAAc,EAAE,CAACC,MAAM,CAACC,gBAAgB,CAAC;EACvD;EAEAD,MAAMA,CAACC,gBAAsC,EAAoB;IAC/D,IAAI,CAACA,gBAAgB,GAAGA,gBAAgB;IACxC,OAAO,IAAI;EACb;EAEA,OAAOC,KAAKA,CAAA,EAA4B;IACtC,OAAO,IAAI,CAACH,cAAc,EAAE,CAACG,KAAK,EAAE;EACtC;EAEAA,KAAKA,CAAA,EAA4B;IAC/B,MAAMD,gBAAgB,GAAG,IAAI,CAACA,gBAAgB;IAC9C,MAAME,iBAAiB,GAAG,IAAI,CAACC,eAAe;IAC9C,OAAQC,MAA8B,IAAK;MACzC,SAAS;;MACT,IAAIC,UAEH,GAAG,CAAC,CAAC;MACN,MAAMC,aAEL,GAAG,CAAC,CAAC;MAEN,IAAIN,gBAAgB,EAAE;QACpBK,UAAU,GAAGL,gBAAgB,CAACI,MAAM,CAAC;QACrC,KAAK,MAAMG,GAAG,IAAIF,UAAU,EAAE;UAC5B,IAAI,CAACX,cAAc,CAACc,QAAQ,CAACD,GAAG,CAAC,EAAE;YACjC,MAAME,KAAK,CAAE,aAAYF,GAAI,yBAAwB,CAAC;UACxD;QACF;MACF,CAAC,MAAM;QACL,KAAK,MAAMG,QAAQ,IAAIhB,cAAc,EAAE;UACrC,IAAIgB,QAAQ,KAAK,WAAW,EAAE;YAC5B,MAAMC,MAAM,GAAGP,MAAM,CAACQ,qBAAqB;YAC3CP,UAAU,CAACQ,eAAe,GAAGpB,UAAU,CAACkB,MAAM,EAAE;cAC9C;cACAG,QAAQ,EAAEZ;YACZ,CAAC,CAAC;UACJ,CAAC,MAAM;YACL,MAAMa,gBAAgB,GACpB,QAAQ,GAAGL,QAAQ,CAACM,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,EAAE,GAAGP,QAAQ,CAACQ,KAAK,CAAC,CAAC,CAAC;YACjEb,UAAU,CAACK,QAAQ,CAAC,GAAGjB,UAAU,CAACW,MAAM,CAACW,gBAAgB,CAAC,EAAE;cAC1D;cACAD,QAAQ,EAAEZ;YACZ,CAAC,CAAC;UACJ;QACF;MACF;MAEA,KAAK,MAAMQ,QAAQ,IAAIL,UAAU,EAAE;QACjC,IAAIK,QAAQ,KAAK,WAAW,EAAE;UAC5BJ,aAAa,CAACO,eAAe,GAAGT,MAAM,CAACe,sBAAsB;QAC/D,CAAC,MAAM;UACL,MAAMC,iBAAiB,GACrB,SAAS,GAAGV,QAAQ,CAACM,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,EAAE,GAAGP,QAAQ,CAACQ,KAAK,CAAC,CAAC,CAAC;UAClEZ,aAAa,CAACI,QAAQ,CAAC,GAAGN,MAAM,CAACgB,iBAAiB,CAAC;QACrD;MACF;MAEA,OAAO;QAAEd,aAAa;QAAED;MAAW,CAAC;IACtC,CAAC;EACH;AACF;AAEA,OAAO,MAAMgB,uBAAuB,GAAG1B,gBAAgB"}